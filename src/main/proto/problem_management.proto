syntax = "proto3";

package edu.kit.tm.cm.proto;

option java_multiple_files = true;
option java_package = "edu.kit.tm.cm.proto";

import "google/protobuf/timestamp.proto";

//TODO filter implementation

service ProblemManagement {
  rpc ListProblems(ListProblemsRequest) returns (ListProblemsResponse);
  rpc GetProblem(GetProblemRequest) returns (GetProblemResponse);
  rpc CreateProblem(CreateProblemRequest) returns (CreateProblemResponse);
  rpc UpdateProblem(UpdateProblemRequest) returns (UpdateProblemResponse);
  rpc RemoveProblem(RemoveProblemRequest) returns (RemoveProblemResponse);

  rpc AcceptProblem(ChangeStateRequest) returns (ChangeStateResponse);
  rpc HoldProblem(ChangeStateRequest) returns (ChangeStateResponse);
  rpc ApproachProblem(ChangeStateRequest) returns (ChangeStateResponse);
  rpc DeclineProblem(ChangeStateRequest) returns (ChangeStateResponse);
  rpc CloseProblem(ChangeStateRequest) returns (ChangeStateResponse);
}

// requests and responses

message ListProblemsRequest{}

message ListProblemsResponse{
  GrpcProblems problems = 1;
  ResponseMessage response_message = 2;
}

message GetProblemRequest{
  string identification_number = 1;
}

message GetProblemResponse{
  GrpcProblem problem = 1;
  ResponseMessage response_message = 2;
}

message CreateProblemRequest{
  GrpcProblem problem = 1;
}

message CreateProblemResponse{
  GrpcProblem problem = 1;
  ResponseMessage response_message = 2;
}

message UpdateProblemRequest{
  GrpcProblem problem = 1;
}

message UpdateProblemResponse{
  GrpcProblem problem = 1;
  ResponseMessage response_message = 2;
}

message RemoveProblemRequest{
  string identification_number = 1;
}

message RemoveProblemResponse{
  ResponseMessage response_message = 1;
}

message ChangeStateRequest{
  string identification_number = 1;
}

message ChangeStateResponse{
  ResponseMessage response_message = 1;
}

// api response piece

message ResponseMessage {
  bool successful = 1;
  string message = 2;
}

// single message constructions

message GrpcProblem{
  GrpcProblemState problem_state = 1;
  string identification_number = 2;
  string problem_title = 3;
  string problem_description = 4;
  string problem_reporter = 5;
  google.protobuf.Timestamp creation_time = 6;
  string notification_identification_number = 7;
  string reference_identification_number = 8;
  GrpcStateOperations possibleStateOperations = 9;
}

enum GrpcProblemState{
  UNKNOWN_PROBLEM_STATE = 0;
  DECLINED = 1;
  OPEN = 2;
  CLOSED = 3;
  IN_PROGRESS = 4;
  ACCEPTED = 5;
}

enum GrpcStateOperation{
  UNKNOWN_STATE_OPERATION = 0;
  ACCEPT = 1;
  CLOSE = 2;
  DECLINE = 3;
  APPROACH = 4;
  HOLD = 5;
}

// multi message constructions

message GrpcProblems{
  repeated GrpcProblem problems = 1;
}

message GrpcStateOperations{
  repeated GrpcStateOperation state_operations = 1;
}
